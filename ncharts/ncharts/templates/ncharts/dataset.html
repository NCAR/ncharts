{% extends "ncharts/base.html" %}

{% block head %}
{{ form.media }}
{% endblock %}

{% block title %}{{ dataset }}{% endblock %}

{% block headline %}Dataset: {{ dataset }}, Project: <a href="{% url 'ncharts:project' dataset.project.name %}">{{ dataset.project.name }}</a>{% endblock %}

{% block content %}

<div class="row">
{{ form.non_field_errors }}
</div>

{% if form %}
    <form action="{% url 'ncharts:dataset' dataset.project.name dataset.name %}" method="post">
        {% csrf_token %}

            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Time</h3>
                    </div>
                    <div class="panel panel-body">
                        <strong>{{ form.start_time.errors }} {{ form.time_length.errors }} {{ form.time_length_units.errors }}</strong>
                        <div class="col-md-3">
                            <span class="label label-default">Start:</span>
                            {{ form.start_time }}
                        </div>
                        <div class="col-md-3">
                            <span class="label label-default">Track Real Time:</span>
                            {{ form.track_real_time }}
                        </div>
                        <div class="col-md-3">
                            <span class="label label-default">Time Zone:</span>
                            {{ form.timezone }}
                        </div>
                        <div class="col-md-3">
                            <span class="label label-default">Length:</span>
                            {{ form.time_length }} {{ form.time_length_units }}
                        </div>
                    </div>
                </div>
            </div>
        {% if dataset.dset_type == 'sounding' %}
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Soundings</h3>
                    </div>
                    <div class="panel panel-body">
                        <div class="input-group">
                            {% if form.soundings|length < 4%}
                            <label for="id_soundings_all">
                                <input data-mini="true" id="id_soundings_all" type="checkbox" value="set all"/>set all</label>
                            {% endif %}
                            <label for="id_soundings_clear">
                                <input data-mini="true" id="id_soundings_clear" type="checkbox" value="clear all"/>clear all</label>
                        </div>
                        <div id="sounding-checkbox">
                        {% for sndg in form.soundings %}
                            {{ sndg }}
                        {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Variables</h3>
                    </div>
                    <div class="panel panel-body">
                        <div class="input-group">
                            {% if form.variables|length < 20%}
                            <label for="id_variables_all">
                                <input data-mini="true" id="id_variables_all" type="checkbox" value="set all"/>set all</label>
                            {% endif %}
                            <label for="id_variables_clear">
                                <input data-mini="true" id="id_variables_clear" type="checkbox" value="clear all"/>clear all</label>
                        </div>
                        <div id="variable-checkbox">
                        {% for var in form.variables %}
                            {{ var }}
                        {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        <div class="row">
            <div class="col-md-6">
                <div class="btn-group">
                    <button type="submit" name="submit" class="btn btn-default"
                        value="plot">Plot</button>
                </div>
                <div class="btn-group">
                    <button type="submit" name="submit" class="btn btn-default"
                        value="page-backward">Back</button>
                    <button type="submit" name="submit" class="btn btn-default"
                        value="page-forward">Forward</button>
                </div>
            </div>
        </div>
    </form>
{% endif %}

{% if data %}
    <script>
        var plot_time0 = jQuery.parseJSON('{{ time0 }}');
        var plot_times = jQuery.parseJSON('{{ time }}');
        var plot_data = jQuery.parseJSON('{{ data }}');
        // dim2 are values for 2nd dimension for heatmap plots
        var plot_dim2 = jQuery.parseJSON('{{ dim2 }}');
        // url to use with ajax to get real time data
{% if form.track_real_time.value %}
        var ajaxurl = "{% url 'ncharts:data' selid %}";
{% endif %}
        var soundings = jQuery.parseJSON('{{ soundings }}');
    </script>

    {% for group,val in plot_groups.items %}
    <div class="chart-wrapper">
      <div class="chart-inner">
	<div id="{{ val.plot_type }}_{{ group }}" style="width:100%; height: 100%;" class="do_plot"></div>
      </div>
    </div>    
        <script>
            var div = $("#{{ val.plot_type }}_{{ group }}")[0];
            jQuery.data(div,"series",'{{ val.series }}');
            jQuery.data(div,"variables",jQuery.parseJSON('{{ val.variables }}'));
            jQuery.data(div,"units",jQuery.parseJSON('{{ val.units }}'));
            jQuery.data(div,"long_names",jQuery.parseJSON('{{ val.long_names }}'));
            jQuery.data(div,"dim2_name","{{ dim2.name }}");
            jQuery.data(div,"ajaxurl","{% url 'ncharts:data' selid %}");
        </script>
    {% endfor %}
{% endif %}
{% endblock %}
