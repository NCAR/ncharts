{% extends "ncharts/base.html" %}

{% block title %}Dataset{% endblock %}

{% block head %}
{{ form.media }}
{% endblock %}

{% block content %}

<p>{{ dataset.project.name }} {{ dataset.name}} </p>

{% if form %}
    <form action="{% url 'ncharts:dataset' dataset.project.name dataset.name %}" method="post">
        {% csrf_token %}

        {{ form.non_field_errors }}

        <div class="variable">
            {% for var in form.variables %}
                            {{ var }}
            {% endfor %}
        </div>
        <div id="time-selection">
        {{ form.start_time.label_tag }} {{ form.start_time }}<strong>{{ form.start_time.errors }}</strong>
        {{ form.time_length_choice.label_tag }} {{ form.time_length_choice }} {{ form.time_length_val }}
        {{ form.time_length_units }}<strong>{{ form.time_length_choice.errors }} {{ form.time_length_val.errors }} {{ form.time_length_units.errors }}</strong>
        </div>
        
        <input type="submit" name="submit" value="page-backward"/>
        <input type="submit" name="submit" value="plot"/>
        <input type="submit" name="submit" value="page-forward"/>
    </form>
{% endif %}

{% if data %}
    <script>
        var time0 = {{ time0 }};
        var time = jQuery.parseJSON('{{ time }}');
        // dim2 is values for 2nd dimension for heatmap plots
        var data = jQuery.parseJSON('{{ data }}');
        var dim2 = jQuery.parseJSON('{{ dim2 }}');
    </script>

    {% for group,val in plot_groups.items %}
        <div id="{{ val.plot_type }}_{{ group }}" class="do_plot">
        </div>
        <script>
            var div = $("#{{ val.plot_type }}_{{ group }}")[0];
            jQuery.data(div,"variables",jQuery.parseJSON('{{ val.variables }}'));
            jQuery.data(div,"units",jQuery.parseJSON('{{ val.units }}'));
            jQuery.data(div,"long_names",jQuery.parseJSON('{{ val.long_names }}'));
            jQuery.data(div,"dim2_name","{{ dim2.name }}");
        </script>
    {% endfor %}
{% endif %}

{% endblock %}
