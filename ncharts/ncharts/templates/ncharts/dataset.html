{% extends "ncharts/base.html" %}

{% block head %}
{{ form.media }}
{% endblock %}

{% block title %}{{ dataset }}{% endblock %}

{% block headline %}Dataset: {{ dataset }}, Project: <a href="{% url 'ncharts:project' dataset.project.name %}">{{ dataset.project.name }}</a>{% endblock %}

{% block content %}

<div class="row">
{{ form.non_field_errors }}
</div>

{% if form %}
    <form action="{% url 'ncharts:dataset' dataset.project.name dataset.name %}" method="post">
        {% csrf_token %}

        <div class="row">
            <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Variables</h3>
                    </div>
                    <div class="panel panel-primary">
                        <div class="input-group">
                        {% for var in form.variables %}
                            {{ var }}
                        {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Time</h3>
                    </div>
                    <div class="panel panel-primary">
                        <strong>{{ form.start_time.errors }} {{ form.time_length.errors }} {{ form.time_length_units.errors }}</strong>
                        <span class="label label-default">Start:</span>
                        {{ form.start_time }}
                        <span class="label label-default">Time Zone:</span>
                        {{ form.timezone }}
                        <span class="label label-default">Length:</span>
                        {{ form.time_length }} {{ form.time_length_units }}
                    </div>
                </div>
            </div>
        </div>
                
        <div class="row">
            <div class="col-md-6">
                <div class="btn-group">
                    <button type="submit" name="submit" class="btn btn-default"
                        value="plot">Plot</button>
                </div>
                <div class="btn-group">
                    <button type="submit" name="submit" class="btn btn-default"
                        value="page-backward">Back</button>
                    <button type="submit" name="submit" class="btn btn-default"
                        value="page-forward">Forward</button>
                </div>
            </div>
        </div>
    </form>
{% endif %}

{% if data %}
    <script>
        var time0 = {{ time0 }};
        var time = jQuery.parseJSON('{{ time }}');
        // dim2 is values for 2nd dimension for heatmap plots
        var data = jQuery.parseJSON('{{ data }}');
        var dim2 = jQuery.parseJSON('{{ dim2 }}');
    </script>

    {% for group,val in plot_groups.items %}
        <div id="{{ val.plot_type }}_{{ group }}" class="do_plot">
        </div>
        <script>
            var div = $("#{{ val.plot_type }}_{{ group }}")[0];
            jQuery.data(div,"variables",jQuery.parseJSON('{{ val.variables }}'));
            jQuery.data(div,"units",jQuery.parseJSON('{{ val.units }}'));
            jQuery.data(div,"long_names",jQuery.parseJSON('{{ val.long_names }}'));
            jQuery.data(div,"dim2_name","{{ dim2.name }}");
        </script>
    {% endfor %}
{% endif %}

{% endblock %}
