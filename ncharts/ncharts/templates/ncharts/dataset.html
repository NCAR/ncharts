{% extends "ncharts/base.html" %}

{% block title %}Dataset{% endblock %}

{% block head %}
{{ form.media }}
{% endblock %}

{% block content %}

<p>{{ dataset.project.name }} {{ dataset.name}} </p>

{% if form %}
    <form action="{% url 'ncharts:dataset' dataset.project.name dataset.name %}" method="post">
        {% csrf_token %}

        {{ form.non_field_errors }}

        <div class="variable">
            {% for var in form.variables %}
                            {{ var }}
            {% endfor %}
        </div>
        <div id="time-selection">
        {{ form.start_time.label_tag }} {{ form.start_time }}<strong>{{ form.start_time.errors }}</strong>
        {{ form.end_time.label_tag }} {{ form.end_time }}<strong>{{ form.end_time.errors }}</strong>
        </div>
        
        <input type="submit" name="submit" value="page-backward"/>
        <input type="submit" name="submit" value="plot"/>
        <input type="submit" name="submit" value="page-forward"/>
    </form>
{% endif %}

{% if data %}
    <script>
        var time0 = {{ time0 }};
        var time = jQuery.parseJSON('{{ time }}');
        // dim2 is values for 2nd dimension for heatmap plots
        var dim2 = jQuery.parseJSON('{{ dim2 }}');
        var data = jQuery.parseJSON('{{ data }}');
    </script>

    {% for vname,val in variables.items %}
        <!--
        <p> {{ val.plot_type }}</p>
        -->
        <div id="{{ val.plot_type }}_{{ vname }}" class="do_plot">
        </div>
        <script>
            var div = $("#{{ val.plot_type }}_{{ vname }}")[0];
            jQuery.data(div,"variable","{{ vname }}");
            jQuery.data(div,"units","{{ val.units }}");
            jQuery.data(div,"long_name","{{ val.long_name }}");
            jQuery.data(div,"dim2_name","{{ val.dim2_name }}");
        </script>
    {% endfor %}
{% endif %}

{% endblock %}
