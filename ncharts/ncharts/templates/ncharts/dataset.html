{% extends "ncharts/base.html" %}

{% block title %}Dataset{% endblock %}

{% block head %}
{{ form.media }}
{% endblock %}

{% block content %}

<p>{{ dataset.project.name }} {{ dataset.name}} </p>

{% if form %}
    <form action="{% url 'ncharts:dataset' dataset.project.name dataset.name %}" method="post">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <div class="variable">
            {% for var in form.variables %}
                            {{ var }}
            {% endfor %}
        </div>
        {{ form.start_time }}{{ form.start_time.errors }}
        {{ form.end_time }}{{ form.end_time.errors }}
        
        <input type="submit" value="choose"/>
    </form>
{% endif %}

{% if data %}
    <script>
        var time0 = {{ time0 }};
        var time = jQuery.parseJSON('{{ time }}');
        var data = jQuery.parseJSON('{{ data }}');
    </script>

    {% for vname,val in variables.items %}

    <p> {{ val.plot_type }}</p>
        <div id="{{ val.plot_type }}_{{ vname }}" class="do_plot">
        </div>
        <script>
            var div = $("#{{ val.plot_type }}_{{ vname }}")[0];
            jQuery.data(div,"variable","{{ vname }}");
            jQuery.data(div,"units","{{ val.units }}");
            jQuery.data(div,"long_name","{{ val.long_name }}");
        </script>
    {% endfor %}
{% endif %}

{% endblock %}
